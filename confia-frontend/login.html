<!DOCTYPE html>
<html lang="pt-BR" class="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - Hub Central</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          animation: {
            'bg-gradient': 'bg-gradient 20s ease infinite',
            'card-entrance': 'card-entrance 1.2s ease-out forwards',
            'shine': 'shine 2s infinite'
          },
          keyframes: {
            'bg-gradient': {
              '0%, 100%': { backgroundPosition: '0% 50%' },
              '50%': { backgroundPosition: '100% 50%' },
            },
            'card-entrance': {
              '0%': { transform: 'scale(0.95)', opacity: '0', filter: 'blur(5px)' },
              '100%': { transform: 'scale(1)', opacity: '1', filter: 'blur(0)' },
            },
            'shine': {
              '100%': { transform: 'translateX(100%)' }
            }
          },
        },
      },
    }
  </script>

  <link rel="icon" type="image/png" href="logo_confia.png">

  <style>
    .login-bg {
      background: linear-gradient(135deg, #a7e0ff, #82b1ff, #64b5f6, #42a5f5);
      background-size: 400% 400%;
      animation: bg-gradient 20s ease infinite;
    }

    .dark .login-bg {
      background: linear-gradient(135deg, #1e3a8a, #111827, #2d3748, #4a5568);
      background-size: 400% 400%;
    }

    @keyframes shine {
      100% {
        transform: translateX(100%);
      }
    }
  </style>
</head>

<body class="bg-gray-100 dark:bg-slate-900 font-sans flex items-center justify-center min-h-screen login-bg">

  <!-- Botão de alternância de tema (somente ícone) -->
  <button id="themeToggle" class="fixed top-5 left-6 z-50 text-yellow-500 dark:text-yellow-300 
      hover:scale-110 transition-transform duration-300 focus:outline-none">
    <i id="themeIcon" class="fas fa-sun text-2xl drop-shadow-md"></i>
  </button>

  <!-- Botão Voltar -->
  <a href="index.html" class="fixed top-4 right-4 z-50 bg-white dark:bg-gray-800 text-gray-700 dark:text-white 
      hover:bg-gray-100 dark:hover:bg-gray-700 p-3 rounded-full transition-all duration-300 shadow-xl 
      hover:shadow-2xl border border-gray-200 dark:border-gray-600 group">
    <i class="fas fa-arrow-left text-lg"></i>
    <span class="absolute right-full mr-3 top-1/2 transform -translate-y-1/2 bg-gray-800 dark:bg-gray-700 
      text-white text-sm px-3 py-1 rounded-md opacity-0 group-hover:opacity-100 
      transition-opacity whitespace-nowrap shadow-lg">Voltar ao início</span>
  </a>

  <main class="container mx-auto px-4 py-6 flex items-center justify-center min-h-screen">
    <div class="w-full max-w-2xl bg-white dark:bg-slate-800/80 backdrop-blur-md rounded-2xl shadow-2xl overflow-hidden 
        md:flex md:h-[450px] transition-all duration-300 transform animate-card-entrance">

      <!-- LADO ESQUERDO -->
      <div class="hidden md:flex md:w-1/2 bg-gradient-to-br from-blue-600 to-blue-800 dark:from-blue-800 dark:to-blue-900 
          flex-col items-center justify-center text-white p-6 relative">
        <img src="logo_confia.png" alt="Logo Confia" class="w-32 mb-4 drop-shadow-lg relative z-10">
        <h2 class="text-3xl font-bold mb-2 text-center drop-shadow relative z-10">Bem-vindo(a) de volta!</h2>
        <p class="text-sm text-center opacity-90 mt-2 relative z-10">
          Entre para acessar o seu portal de notícias completo e personalizado.
        </p>
      </div>

      <!-- LADO DIREITO -->
      <div class="w-full md:w-1/2 p-8 flex flex-col justify-center">
        <h2 class="text-3xl font-bold text-gray-800 dark:text-white text-center mb-7">
          Fazer Login
        </h2>

        <form id="loginForm" action="#" method="POST" class="space-y-6">

          <div>
            <label for="email" class="text-sm font-medium text-gray-700 dark:text-gray-300 block mb-1">E-mail</label>
            <input
              type="email"
              id="email"
              name="email"
              placeholder="seu-email@exemplo.com"
              required
              class="w-full pr-4 py-3 rounded-lg bg-gray-50 dark:bg-slate-700 
              text-gray-800 dark:text-gray-200 border border-gray-300 dark:border-slate-600 
              focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors">
          </div>

          <div>
            <label for="password" class="text-sm font-medium text-gray-700 dark:text-gray-300 block mb-1">Senha</label>
            <input
              type="password"
              id="password"
              name="password"
              placeholder="••••••••"
              required
              class="w-full pr-4 py-3 rounded-lg bg-gray-50 dark:bg-slate-700 
              text-gray-800 dark:text-gray-200 border border-gray-300 dark:border-slate-600 
              focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors">
          </div>

          <div class="flex justify-end text-sm">
            <a href="#" class="text-blue-600 hover:underline dark:text-blue-400">
              Esqueceu a senha?
            </a>
          </div>

          <!-- BOTÃO MELHORADO -->
          <button
            type="submit"
            id="entrarBtn"
            class="w-full relative overflow-hidden bg-gradient-to-r from-blue-600 via-blue-700 to-indigo-600 
                   text-white py-3.5 rounded-lg font-semibold shadow-lg transition-all duration-300 
                   hover:shadow-blue-500/50 hover:scale-[1.02] focus:outline-none focus:ring-4 focus:ring-blue-400">
            
            <span class="relative z-10">Entrar</span>
            <span class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent 
                         translate-x-[-100%] animate-[shine_2s_infinite]"></span>
          </button>

          <p class="text-center text-sm text-gray-600 dark:text-gray-400 mt-4">
            Não tem uma conta?
            <a href="Cadastre.html" class="text-blue-600 hover:underline dark:text-blue-400 font-medium">
              Cadastre-se
            </a>
          </p>
        </form>
      </div>
    </div>
  </main>

  <script>
    // --- SELETORES (Login) ---
    const loginForm = document.getElementById('loginForm'); // **Verifique se seu FORM tem id="loginForm"**
    const emailInputLogin = document.getElementById('email');
    const passwordInputLogin = document.getElementById('password');
    const entrarBtn = document.getElementById('entrarBtn'); // **Verifique se seu BOTÃO tem id="entrarBtn"**
    const themeToggleLogin = document.getElementById('themeToggle');
    const themeIconLogin = document.getElementById('themeIcon') || document.getElementById('theme-icon'); // Tenta os dois IDs comuns
    const htmlLogin = document.documentElement;

    // --- LÓGICA DO TEMA ---
    function toggleThemeLogin() {
        if (!htmlLogin || !themeIconLogin) return;
        const isDark = htmlLogin.classList.toggle('dark'); htmlLogin.classList.toggle('light', !isDark);
        if (isDark) { themeIconLogin.classList.remove('fa-sun'); themeIconLogin.classList.add('fa-moon'); localStorage.setItem('theme', 'dark'); }
        else { themeIconLogin.classList.remove('fa-moon'); themeIconLogin.classList.add('fa-sun'); localStorage.setItem('theme', 'light'); }
    }
    function carregarTemaLogin() {
        if (!htmlLogin || !themeIconLogin) return;
        const p = localStorage.getItem('theme'), s = window.matchMedia('(prefers-color-scheme: dark)').matches, i = p || (s ? 'dark' : 'light');
        htmlLogin.classList.remove('light', 'dark'); htmlLogin.classList.add(i);
        if (i === 'dark') { themeIconLogin.classList.remove('fa-sun'); themeIconLogin.classList.add('fa-moon'); }
        else { themeIconLogin.classList.remove('fa-moon'); themeIconLogin.classList.add('fa-sun'); }
    }

    // --- LÓGICA DO FORMULÁRIO DE LOGIN ---
    if (loginForm && emailInputLogin && passwordInputLogin && entrarBtn) {
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault(); // Impede o envio padrão

            const email = emailInputLogin.value.trim();
            const password = passwordInputLogin.value.trim();

            if (!email || !password) {
                alert("Por favor, preencha e-mail e senha.");
                return;
            }

            // Feedback visual
            entrarBtn.textContent = 'Entrando...';
            entrarBtn.disabled = true;

            try {
                const response = await fetch('http://localhost:3000/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password }),
                });

                const data = await response.json();

                if (response.ok) { // Status 200 OK
                    // --- SUCESSO! Armazena token e user info ---
                    localStorage.setItem('authToken', data.token);
                    localStorage.setItem('userInfo', JSON.stringify({
                        id: data.user.id, // Guarda o ID também, pode ser útil
                        nome: data.user.nome,
                        email: data.user.email
                    }));
                    // alert('Login realizado com sucesso!'); // Opcional
                    window.location.href = 'index.html'; // Redireciona para home
                } else {
                    alert(`Erro no login: ${data.message || `Erro ${response.status}`}`);
                    // Restaura botão em caso de erro
                    entrarBtn.textContent = 'Entrar';
                    entrarBtn.disabled = false;
                }
            } catch (error) {
                console.error('Erro na requisição:', error);
                alert('Não foi possível conectar ao servidor. Tente novamente.');
                // Restaura botão em caso de erro de rede
                entrarBtn.textContent = 'Entrar';
                entrarBtn.disabled = false;
            }
        });
    } else {
        console.error("Erro: Não foi possível encontrar todos os elementos do formulário de login.");
    }

    // --- INICIALIZAÇÃO (Login) ---
    document.addEventListener('DOMContentLoaded', () => {
        carregarTemaLogin();
        // Verifica se os seletores foram encontrados
        if (!loginForm) console.error("Elemento #loginForm não encontrado.");
        if (!emailInputLogin) console.error("Elemento #email não encontrado.");
        if (!passwordInputLogin) console.error("Elemento #password não encontrado.");
        if (!entrarBtn) console.error("Elemento #entrarBtn não encontrado.");
        if (!themeToggleLogin) console.error("Elemento #themeToggle não encontrado.");
    });

     // Adiciona listener do tema APÓS o DOM carregar
     if (themeToggleLogin) {
        themeToggleLogin.addEventListener('click', toggleThemeLogin);
     }

</script>

</body>
</html>
